# Transformer-Based Stock Portfolio
## System Overview

This system implements a sophisticated stock portfolio selection and analysis framework using:

### 1. **Transformer Neural Network**
- Multi-head attention mechanism for capturing temporal dependencies in stock prices
- Predicts both mean return and uncertainty (standard deviation)
- Architecture:
  - Input: 5 features (returns, log returns, volume change, SMA ratios, volatility)
  - Sequence length: 20 days
  - Transformer layers: 2 layers with 4 attention heads
  - Output: Gaussian distribution parameters (mean, std)

### 2. **T-Student Distribution for Stock Trade Composition**
- Uses t-distribution for probabilistic assessment of stock composition over time of trade
- Calculates t-statistic: t = predicted_return / uncertainty
- Degrees of freedom based on historical data length
- Confidence interval approach: Only selects stocks with positive lower CI bounds
- Composite scoring: Combines probability (50%) and Sharpe-like ratio (50%)

### 3. **Portfolio Construction**
- **Input**: Top 50 stocks csv generated by screener using momentum indicator
- **Selection**: 1-7 stocks dynamically chosen based on:
  - T-distribution confidence (97,5%)
  - Positive expected returns with statistical significance
  - Risk-adjusted performance metrics
- **Weighting**: Equal-weighted portfolio
- **Period**: January 1, 2025 to December 24, 2025

### 4. **Performance Metrics**

#### A. Sortino Ratio
```
Sortino = (Mean Excess Return) / (Downside Deviation) × √252
```

#### B. Maximum Drawdown
```
Max Drawdown = min((Current Value - Peak Value) / Peak Value)
```

#### C. Cumulative Return
```
Cumulative Return = ∏(1 + Daily Return) - 1
```

### 5. **Additional Metrics**
- **Sharpe Ratio**: Risk-adjusted return using total volatility
- **Alpha**: Excess return over benchmark
- **Beta**: Portfolio sensitivity to market movements
- **Annualized Volatility**: Standard deviation of returns (annualized)

### 6. **Technical Features**
The system creates 9 technical indicators for each stock:
1. Returns (daily percentage change)
2. Log returns (for better statistical properties)
3. Volume change
4. 5-day SMA ratio
5. 10-day SMA ratio
6. 10-day rolling volatility
7. 5-day momentum
8. 10-day momentum
9. High-Low spread

### 7. **Model Training Process**
For each of the 50 stocks:
1. Download historical data (Jan 1 - Dec 24, 2025)
2. Create technical features
3. Prepare sequences (20-day windows)
4. Train transformer model (30 epochs)
5. Predict next-day return with uncertainty
6. Calculate t-statistic and probability
7. Rank stocks by composite score

### 8. **Output Files**

#### portfolio_composition.csv
- Lists selected stocks
- Shows equal weights assigned to each

#### performance_metrics.csv
- Portfolio metrics (Cumulative Return, Sortino, Max Drawdown, Sharpe, Volatility)
- Benchmark metrics (same metrics for S&P 500)
- Side-by-side comparison

### 9. **Why This Approach?**

**Transformer Model Advantages:**
- Captures long-range dependencies in price movements
- Self-attention mechanism identifies important historical patterns
- Provides uncertainty estimates for robust decision-making

**T-Distribution Advantages:**
- More appropriate for small sample sizes than normal distribution
- Accounts for estimation uncertainty
- Heavier tails capture extreme market events better

**Portfolio Benefits:**
- Statistically rigorous stock selection
- Risk-aware allocation
- Transparent performance measurement
- Benchmark comparison for validation

This creates a robust, interpretable system that balances sophisticated ML with statistical rigor.
